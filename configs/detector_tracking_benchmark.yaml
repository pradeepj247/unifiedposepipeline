# Detector Configuration for Tracking Benchmark
# Testing BoxMOT tracking without ReID (ByteTrack) on campus_walk.mp4
# Goal: Maximize speed using ByteTrack without appearance ReID

# ============================================================================
# Detector Settings
# ============================================================================
detector:
  type: yolo  # Options: yolo, rtmdet
  model_path: models/yolo/yolov8s.pt  # Path to detector model
  confidence: 0.3  # Confidence threshold for detections
  device: 0  # Device to use: 0 (GPU 0), 1 (GPU 1), or cpu
  detect_only_humans: true  # Only detect person class (COCO class 0)

# ============================================================================
# Processing Settings
# ============================================================================
processing:
  # Resolution for detection/tracking processing
  # Options:
  #   - [width, height]: Process at specific resolution (e.g., [1280, 720])
  #   - null: Use original video resolution (no downscaling)
  # 
  # Lower resolution = faster processing (2.25x speedup for 720p vs 1080p)
  # Bboxes are automatically scaled back to original resolution
  # 
  # Recommended resolutions:
  #   - [1920, 1080]: Original (slowest, best accuracy)
  #   - [1280, 720]: 720p (2x faster, good accuracy) <- Recommended
  #   - [960, 540]: 540p (3x faster, may miss small persons)
  processing_resolution: [1280, 720]  # Process at 720p for 2x speedup

# ============================================================================
# Tracking Settings - BENCHMARK CONFIGURATION
# ============================================================================
tracking:
  enabled: true  # Enable tracking
  half: true     # Use FP16 for tracker/ReID when on GPU (faster); auto-disabled on CPU
  
  # Tracker selection: Using ByteTrack for speed (no ReID needed)
  # Options: botsort, bytetrack, boosttrack, deepocsort, strongsort, ocsort, hybridsort
  tracker: bytetrack  # Fastest option; no appearance model
  
  # Re-Identification (ReID) Settings - ENABLED FOR BENCHMARK
  reid:
    enabled: false  # Disable ReID for maximum speed (ByteTrack works motion-only)
    
    # Available ReID models (PyTorch - all support dynamic batching):
    #   - osnet_x0_25_msmt17.pt  (lightweight, ~0.2M params, ~20-25 FPS) <- Default
    #   - osnet_x1_0_msmt17.pt   (large, ~2.2M params, ~12 FPS, better accuracy)
    # 
    # Default is x0.25 for 2x speed improvement with minimal accuracy loss
    # Switch to x1.0 if you need maximum accuracy and don't mind slower speed
    # 
    # Note: ONNX models (osnet_x0_25_msmt17.onnx) have fixed batch sizes
    # and are not compatible with BoxMOT's dynamic batching
    weights_path: models/reid/osnet_x0_25_msmt17.pt  # Fast & accurate
    
    # Note: ReID model will be auto-downloaded if not found
  
  # Output mode
  largest_bbox_only: false  # Multi-person tracking (false = all persons, true = largest only)
  
  # Tracker Parameters (Advanced Tuning)
  # These parameters control tracking behavior and can be adjusted based on video characteristics
  params:
    # Detection confidence thresholds
    det_thresh: 0.3        # Minimum detection confidence (0.1-0.5)
    min_conf: 0.1          # Minimum confidence for low-confidence matching (ByteTrack feature)
    track_thresh: 0.45     # Confidence to start new track (0.4-0.6)
    
    # Matching thresholds
    match_thresh: 0.8      # IoU threshold for matching (0.5-0.9, higher = stricter)
    iou_threshold: 0.3     # NMS IoU threshold for removing overlapping detections
    
    # Temporal parameters
    max_age: 30            # Frames to keep lost track alive (waiting for reappearance)
    min_hits: 3            # Minimum detections before outputting track
    track_buffer: 25       # Buffer size for track history
    max_obs: 50            # Maximum observations to store per track (should be >= max_age)
    
    # Other settings
    per_class: false       # Track per class separately (keep false for person tracking)
    frame_rate: 30         # Video frame rate (usually auto-detected)

# ============================================================================
# Input/Output Settings
# ============================================================================
input:
  video_path: demo_data/videos/  # Directory containing input videos
  video_filename: kohli_nets.mp4  # Video file name
  max_frames: 0  # Process all frames (0 = no limit)

output:
  detections_file: demo_data/outputs/detections_tracking_reid.npz  # Single bbox per frame (largest)
  raw_detections_file: demo_data/outputs/raw_detections.npz  # All tracked persons (multi-person)
  save_visualization: true  # Save annotated video with track IDs
  visualization_path: demo_data/outputs/  # Output directory (filename auto-generated from input)

# ============================================================================
# Advanced Settings
# ============================================================================
advanced:
  batch_size: 1  # Batch size for detection
  verbose: false  # Print detailed progress and benchmarking info (set true if you need FPS breakdown)
  # 
  # Silent mode (verbose: false) shows:
  #   - Video info (path, resolution, frames)
  #   - Detector/tracker type
  #   - Processing progress bar with FPS
  #   - Frames processed count
  #   - Overall FPS and time taken
  #   - Unique track IDs count
  #   - Writing progress bar
  #   - Saved file confirmations
  # 
  # Verbose mode (verbose: true) additionally shows:
  #   - Model loading messages
  #   - Detailed FPS breakdown (detection/tracking/combined)
  #   - Success rate and valid detections count
  #   - Full track ID table with frame ranges
  #   - File format details
  # 
  # Note: BoxMOT library prints "SUCCESS | ByteTrack:..." message that
  # cannot be suppressed (library-level output, not controlled by our code)

# ============================================================================
# BENCHMARK EXPECTATIONS:
# ============================================================================
# Without tracking/ReID (raw YOLO): ~70 FPS (baseline)
# 
# With ByteTrack (no ReID):
#   - Detection FPS: ~70 FPS (unchanged)
#   - Tracking FPS: Very high (motion-only)
#   - Combined FPS: Largely detector-bound; expect minimal overhead from tracking
#   - Overall FPS: Close to detector FPS (including I/O)
#
# Track ID Stability:
#   - Without ReID: Possible ID switches during heavy occlusions
#   - Unique track IDs: Depends on number of people in video
#
# Output Visualization:
#   - Each person gets unique colored bbox
#   - Track ID shown above bbox
#
# ============================================================================
